<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ACE Team • Ôn thi Nhập môn lập trình (C++)</title>
    <link rel="icon" href="data:," />
    <script src="https://unpkg.com/vue@3.4.38/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="style.css" />
    <script src="./data.js"></script>
  </head>
  <body>
    <div id="app">
      <header class="topbar">
        <div class="brand"><strong>ACE Team</strong> • Ôn thi C++</div>
        <nav class="nav">
          <a :class="{active: view==='home'}" href="#/home">Tổng quan</a>
          <a :class="{active: view==='chapters'}" href="#/chapters">Chương</a>
          <a :class="{active: view==='quizzes'}" href="#/quizzes">Đề ôn tập</a>
          <a :class="{active: view==='flashcards'}" href="#/flashcards">Flashcards</a>
          <a :class="{active: view==='resources'}" href="#/resources">Tài liệu</a>
          <a :class="{active: view==='results'}" href="#/results">Bảng tổng kết</a>
          <a :class="{active: view==='official'}" href="#/official">Đề thi UIT</a>
        </nav>
      </header>

      <main class="container">
        <!-- HOME -->
        <section v-if="view==='home'">
          <h1>Ôn thi Nhập môn lập trình (C++)</h1>
          <p>
            Mỗi ngày 1 đề (~50 câu), ôn flashcards, đánh dấu chương đã học. Tiến trình được lưu bằng
            <code>localStorage</code>.
          </p>
          <div class="grid-3">
            <div class="card">
              <h3>Tiến độ chương</h3>
              <p>
                {{ completedChaptersCount }}/{{ chapters.length }} chương đã đánh dấu hoàn thành.
              </p>
              <div class="progress">
                <div class="bar" :style="{width: chapterProgress+'%'}"></div>
              </div>
              <div class="muted">
                Học xong lý thuyết và miniquiz ở mỗi chương rồi bấm “Đánh dấu đã học”.
              </div>
            </div>
            <div class="card">
              <h3>Tiến độ đề ôn tập</h3>
              <p>{{ passedQuizzes }}/{{ quizzes.length }} đề đạt yêu cầu (≥ {{ passScore }}%).</p>
              <div class="progress">
                <div class="bar" :style="{width: quizProgress+'%'}"></div>
              </div>
              <div class="muted">
                Có thể làm lại đề <em>không giới hạn</em>. Hệ thống lưu điểm cao nhất.
              </div>
            </div>
            <div class="card">
              <h3>Flashcards</h3>
              <p>{{ learnedFlashcardsCount }}/{{ flashcards.length }} thẻ đã ghi nhớ.</p>
              <div class="progress">
                <div class="bar" :style="{width: flashProgress+'%'}"></div>
              </div>
              <div class="muted">
                Ôn hàng ngày theo phương pháp lặp lại ngắt quãng (spaced repetition).
              </div>
            </div>
          </div>

          <div class="actions">
            <a class="btn primary" href="#/quizzes">Bắt đầu làm đề hôm nay</a>
            <a class="btn" href="#/flashcards">Ôn flashcards 10 phút</a>
          </div>
        </section>

        <!-- CHAPTERS -->
        <section v-if="view==='chapters'">
          <h2>Ôn tập theo chương</h2>
          <div class="chapters">
            <aside class="chapters-list">
              <button
                v-for="(c,idx) in chapters"
                :key="idx"
                class="chap-item"
                :class="{'done': isChapterDone(idx)}"
                @click="openChapter(idx)"
              >
                <span>{{ idx+1 }}. {{ c.title }}</span>
                <span v-if="isChapterDone(idx)" class="tick">✔</span>
              </button>
            </aside>
            <article class="chapter-content" v-if="currentChapterIndex!==null">
              <h3>{{ currentChapter.title }}</h3>
              <p v-for="(p,i) in currentChapter.summary" :key="i">{{ p }}</p>
              <details
                v-if="currentChapter.snippets && currentChapter.snippets.length"
                class="snippets"
              >
                <summary>Ví dụ minh họa</summary>
                <pre
                  v-for="(snip,i) in currentChapter.snippets"
                  :key="i"
                ><code>{{ snip }}</code></pre>
              </details>
              <div class="mini-quiz" v-if="currentChapter.quiz && currentChapter.quiz.length">
                <h4>Mini Quiz</h4>
                <div v-for="(q, qi) in currentChapter.quiz" :key="qi" class="qcard">
                  <div class="qtext">{{ qi+1 }}. {{ q.text }}</div>
                  <div class="qopts" v-if="q.type==='mcq'">
                    <label v-for="(opt,oi) in q.options" :key="oi" class="opt">
                      <input
                        type="radio"
                        :name="'c'+currentChapterIndex+'_q'+qi"
                        :value="oi"
                        v-model="miniAnswers[qi]"
                      />
                      {{ opt }}
                    </label>
                  </div>
                  <div v-else-if="q.type==='short'">
                    <input
                      class="short"
                      type="text"
                      v-model="miniAnswers[qi]"
                      placeholder="Nhập đáp án ngắn..."
                    />
                  </div>
                </div>
                <div class="actions">
                  <button class="btn" @click="checkMiniQuiz">Chấm mini quiz</button>
                  <span v-if="miniScore!==null" class="score"
                    >Điểm: {{ miniScore }}/{{ currentChapter.quiz.length }}</span
                  >
                </div>
              </div>
              <div class="actions">
                <button class="btn success" @click="markChapterDone(currentChapterIndex)">
                  Đánh dấu đã học xong
                </button>
              </div>
            </article>
            <article class="chapter-placeholder" v-else>
              <p>Chọn một chương ở bên trái để bắt đầu.</p>
            </article>
          </div>
        </section>

        <!-- QUIZZES -->
        <section v-if="view==='quizzes'">
          <h2>Đề ôn tập (10 đề • 50 câu/đề)</h2>

          <!-- Luyện theo chủ đề: thêm, KHÔNG ảnh hưởng 10 đề mẫu -->
          <div class="card">
            <h3>Luyện theo chủ đề</h3>
            <div class="actions">
              <label
                >Chủ đề:
                <select v-model="selectedTopicKey">
                  <option disabled value="">-- chọn --</option>
                  <option v-for="(label,key) in topicLabels" :key="key" :value="key">
                    {{ label }}
                  </option>
                </select>
              </label>
              <button class="btn" @click="startTopicQuiz" :disabled="!selectedTopicKey">
                Làm đề (20 câu)
              </button>
              <span class="muted">Đề theo chủ đề không lưu vào bảng tổng kết.</span>
            </div>
          </div>

          <div class="quiz-list">
            <div v-for="(t, ti) in quizzes" :key="ti" class="card quiz-item">
              <h3>Đề {{ ti+1 }}</h3>
              <p class="muted">{{ t.description }}</p>
              <div class="quiz-meta">
                <span>Điểm cao nhất: <strong>{{ bestScore(ti) ?? '-' }}</strong>%</span>
                <span>Lần làm: <strong>{{ attempts(ti) }}</strong></span>
                <span
                  >Trạng thái:
                  <strong :class="{'passed': isPassed(ti), 'failed': !isPassed(ti)}">
                    {{ isPassed(ti) ? 'Đã đạt' : 'Chưa đạt' }}
                  </strong>
                </span>
              </div>
              <div class="actions">
                <button class="btn primary" @click="startQuiz(ti)">Làm đề</button>
                <button class="btn" @click="resetQuiz(ti)">Xóa kết quả đề này</button>
              </div>
            </div>
          </div>

          <div v-if="takingQuizIndex!==null || topicMode" class="quiz-take">
            <hr />
            <h3 v-if="!topicMode">Đề {{ takingQuizIndex+1 }}</h3>
            <h3 v-else>Đề theo chủ đề: {{ topicLabels[selectedTopicKey] }}</h3>
            <div v-for="(q, qi) in currentQuizQuestions" :key="qi" class="qcard">
              <div class="qtext">{{ qi+1 }}. {{ q.text }}</div>
              <template v-if="q.type==='mcq'">
                <div class="qopts">
                  <label v-for="(opt,oi) in q.options" :key="oi" class="opt">
                    <input type="radio" :name="'q_'+qi" :value="oi" v-model="quizAnswers[qi]" />
                    {{ opt }}
                  </label>
                </div>
              </template>
              <template v-else-if="q.type==='code-out'">
                <pre><code>{{ q.code }}</code></pre>
                <div class="muted">Dự đoán output:</div>
                <input
                  class="short"
                  type="text"
                  v-model="quizAnswers[qi]"
                  placeholder="Nhập output..."
                />
              </template>
              <template v-else-if="q.type==='short'">
                <input
                  class="short"
                  type="text"
                  v-model="quizAnswers[qi]"
                  placeholder="Nhập đáp án ngắn..."
                />
              </template>
            </div>
            <div class="actions">
              <button class="btn primary" @click="submitQuiz">Nộp bài</button>
              <button class="btn" @click="cancelQuiz">Hủy</button>
            </div>

            <div v-if="quizScore!==null" class="result">
              <h4>Kết quả: {{ quizScore }}%</h4>
              <p class="muted">
                Đáp án của bạn và đáp án đúng sẽ hiển thị bên dưới. Bạn có thể làm lại đề để cải
                thiện điểm.
              </p>
              <div
                v-for="(q, qi) in currentQuizQuestions"
                :key="'a'+qi"
                class="ans"
                :class="getAnswerClass(q, qi)"
              >
                <div class="qtext">Câu {{ qi+1 }}: {{ q.text }}</div>
                <div class="answer-comparison">
                  <div class="user-answer">
                    <span class="label">Đáp án của bạn:</span>
                    <span class="answer-content" :class="getUserAnswerClass(q, qi)">
                      {{ getUserAnswerDisplay(q, qi) }}
                    </span>
                  </div>
                  <div class="correct-answer">
                    <span class="label">Đáp án đúng:</span>
                    <span class="answer-content correct"> {{ getCorrectAnswerDisplay(q) }} </span>
                  </div>
                  <div class="status">
                    <span
                      class="status-icon"
                      :class="isAnswerCorrect(q, qi) ? 'correct' : 'incorrect'"
                    >
                      {{ isAnswerCorrect(q, qi) ? '✓' : '✗' }}
                    </span>
                    <span
                      class="status-text"
                      :class="isAnswerCorrect(q, qi) ? 'correct' : 'incorrect'"
                    >
                      {{ isAnswerCorrect(q, qi) ? 'Đúng' : 'Sai' }}
                    </span>
                  </div>
                </div>
              </div>
              <div class="actions">
                <button class="btn success" @click="redoQuiz">Làm lại đề (xáo trộn)</button>
              </div>
            </div>
          </div>
        </section>

        <!-- FLASHCARDS -->
        <section v-if="view==='flashcards'">
          <h2>Flashcards</h2>
          <div class="flash-controls">
            <label><input type="checkbox" v-model="hideLearned" /> Ẩn thẻ đã nhớ</label>
            <button class="btn" @click="resetFlashcards">Reset đã nhớ</button>
          </div>
          <div class="flashcard" v-if="filteredFlashcards.length">
            <div class="flashcard-inner" :class="{flipped: showAnswer}" @click="toggleFlash">
              <div class="face front">
                <div class="topic">{{ currentFlash.topic }}</div>
                <div class="q">{{ currentFlash.text || currentFlash.question }}</div>
                <div v-if="currentFlash.options" class="options">
                  <div v-for="(option, i) in currentFlash.options" :key="i" class="option">
                    {{ String.fromCharCode(65 + i) }}. {{ option }}
                  </div>
                </div>
                <div class="hint muted">Nhấn để xem đáp án</div>
              </div>
              <div class="face back">
                <div class="topic">{{ currentFlash.topic }}</div>
                <div class="q">{{ currentFlash.text || currentFlash.question }}</div>
                <div v-if="currentFlash.options" class="options">
                  <div
                    v-for="(option, i) in currentFlash.options"
                    :key="i"
                    :class="['option', i === currentFlash.answer ? 'correct' : '']"
                  >
                    {{ String.fromCharCode(65 + i) }}. {{ option }}
                  </div>
                </div>
                <div v-else class="a" v-html="currentFlash.answer"></div>
              </div>
            </div>
            <div class="actions spaced">
              <button class="btn" @click="prevFlash">&larr; Trước</button>
              <button class="btn success" @click="markFlashLearned">Đã nhớ</button>
              <button class="btn" @click="nextFlash">Sau &rarr;</button>
            </div>
            <div class="muted center">{{ flashIndex+1 }}/{{ filteredFlashcards.length }}</div>
          </div>
          <p v-else class="muted">
            Không còn thẻ để ôn (đã ẩn thẻ đã nhớ). Hãy bỏ chọn "Ẩn thẻ đã nhớ" hoặc reset.
          </p>
        </section>

        <!-- RESOURCES -->
        <section v-if="view==='resources'">
          <h2>Tài liệu ôn tập</h2>
          <p>
            Đặt link tài liệu (slide, đề cương, đề mẫu, đáp án...) tại đây. (Tạm thời là mẫu; bạn có
            thể chỉnh trong <code>app.js</code> &rarr; <code>resources</code>.)
          </p>
          <ul class="res">
            <li v-for="(r,ri) in resources" :key="ri">
              <a :href="r.url" target="_blank" rel="noopener">{{ r.title }}</a>
              <span class="muted">— {{ r.note }}</span>
            </li>
          </ul>
        </section>

        <!-- RESULTS -->
        <section v-if="view==='results'">
          <h2>Bảng tổng kết</h2>
          <div class="grid-2">
            <div class="card">
              <h3>Chương</h3>
              <ul>
                <li v-for="(c,idx) in chapters" :key="idx">
                  {{ idx+1 }}. {{ c.title }}
                  <strong :class="{'passed': isChapterDone(idx)}"
                    >{{ isChapterDone(idx) ? 'Đã hoàn thành' : 'Chưa' }}</strong
                  >
                </li>
              </ul>
              <button class="btn" @click="clearChapters">Xóa đánh dấu chương</button>
            </div>
            <div class="card">
              <h3>Đề ôn tập</h3>
              <table class="table">
                <thead>
                  <tr>
                    <th>Đề</th>
                    <th>Điểm cao nhất</th>
                    <th>Lần làm</th>
                    <th>Trạng thái</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(t,ti) in quizzes" :key="ti">
                    <td>Đề {{ ti+1 }}</td>
                    <td>{{ bestScore(ti) ?? '-' }}%</td>
                    <td>{{ attempts(ti) }}</td>
                    <td>
                      <strong :class="{'passed': isPassed(ti), 'failed': !isPassed(ti)}"
                        >{{ isPassed(ti) ? 'Đã đạt' : 'Chưa đạt' }}</strong
                      >
                    </td>
                  </tr>
                </tbody>
              </table>
              <div class="actions">
                <button class="btn" @click="clearQuizResults">Xóa tất cả kết quả</button>
              </div>
            </div>
          </div>
          <div class="card">
            <h3>Tiến trình & Sao lưu</h3>
            <div class="actions">
              <button class="btn" @click="exportProgress">Xuất tiến trình (.json)</button>
              <label class="btn">
                Nhập tiến trình
                <input
                  type="file"
                  accept="application/json"
                  style="display: none"
                  @change="importProgress"
                />
              </label>
              <button class="btn danger" @click="fullReset">Reset toàn bộ</button>
            </div>
            <p class="muted">
              Tiến trình được lưu cục bộ bằng <code>localStorage</code> trên thiết bị của bạn.
            </p>
          </div>
        </section>

        <!-- OFFICIAL UIT EXAM -->
        <section v-if="view==='official'">
          <h2>Đề thi chuẩn UIT Format</h2>
          <div class="card">
            <h3>Tạo đề thi theo format chính thức UIT</h3>
            <p class="muted">
              Sinh đề thi tự luận theo cấu trúc đề thi cuối kỳ của Trường ĐH Công nghệ Thông tin với
              các bài toán lập trình hoàn chỉnh.
            </p>
            <div class="actions">
              <button class="btn primary" @click="generateUitExam">
                Sinh đề thi UIT (PDF-ready)
              </button>
              <button class="btn" @click="printUitExam" v-if="uitExam">In/Xuất PDF</button>
            </div>
          </div>

          <div v-if="uitExam" class="uit-exam-preview">
            <div class="exam-header">
              <div class="exam-info">
                <strong>{{ uitExam.header.university }}</strong><br />
                <strong>{{ uitExam.header.center }}</strong><br /><br />
                <strong>{{ uitExam.header.examTitle }}</strong><br />
                <strong>{{ uitExam.header.subject }}</strong><br />
                <strong>{{ uitExam.header.courseCode }}</strong><br />
                <strong>{{ uitExam.header.duration }}</strong><br />
                <strong>{{ uitExam.header.totalPoints }}</strong><br />
                <em>{{ uitExam.header.instructions }}</em>
              </div>
              <div class="can-bo-coi-thi">
                <strong>CAN BỘ COI THI</strong><br />
                <table style="border: 1px solid #666; width: 100%">
                  <tr>
                    <td style="padding: 8px; border: 1px solid #666">HỌ VÀ TÊN SV:</td>
                    <td style="padding: 8px; border: 1px solid #666; width: 60%"></td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #666">MSSV:</td>
                    <td style="padding: 8px; border: 1px solid #666"></td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #666">LỚP:</td>
                    <td style="padding: 8px; border: 1px solid #666"></td>
                  </tr>
                  <tr>
                    <td style="padding: 8px; border: 1px solid #666">SỐ BÁO DANH:</td>
                    <td style="padding: 8px; border: 1px solid #666"></td>
                  </tr>
                </table>
              </div>
            </div>

            <div class="exam-content">
              <!-- Các phần đề thi -->
              <div v-for="(section, si) in uitExam.sections" :key="si" class="exam-section">
                <h3>{{ section.title }}</h3>
                <p><em>{{ section.note }}</em></p>

                <!-- Trắc nghiệm -->
                <div v-if="section.type === 'multiple_choice'">
                  <div v-for="(question, qi) in section.questions" :key="qi" class="mcq-question">
                    <p><strong>Câu {{ qi + 1 }}:</strong> {{ question.question }}</p>
                    <div class="options">
                      <div v-for="(option, oi) in question.options" :key="oi" class="option">
                        {{ option }}
                      </div>
                    </div>
                    <p class="points">({{ question.points }} điểm)</p>
                  </div>
                </div>

                <!-- Tự luận ngắn -->
                <div v-if="section.type === 'short_answer'">
                  <div v-for="(question, qi) in section.questions" :key="qi" class="short-question">
                    <p><strong>Câu {{ qi + 1 }}:</strong> {{ question.question }}</p>
                    <div class="answer-space">
                      <p>Trả lời:</p>
                      <div
                        class="answer-lines"
                        style="min-height: 100px; border: 1px solid #ccc; margin: 10px 0"
                      ></div>
                    </div>
                    <p class="points">({{ question.points }} điểm)</p>
                  </div>
                </div>

                <!-- Lập trình -->
                <div v-if="section.type === 'programming'">
                  <div
                    v-for="(problem, pi) in section.questions"
                    :key="pi"
                    class="programming-problem"
                  >
                    <h4>Bài {{ pi + 1 }}:</h4>
                    <p>{{ problem.description }}</p>

                    <div v-if="problem.sampleInput" class="sample">
                      <p><strong>Ví dụ:</strong></p>
                      <p><strong>Input:</strong> {{ problem.sampleInput }}</p>
                      <p><strong>Output:</strong></p>
                      <pre>{{ problem.sampleOutput }}</pre>
                    </div>

                    <div class="algorithm-section">
                      <p><strong>Thuật toán:</strong></p>
                      <div
                        class="algorithm-space"
                        style="min-height: 150px; border: 1px solid #ccc; margin: 10px 0"
                      ></div>
                      <p class="points">({{ problem.algorithmPoints }} điểm)</p>
                    </div>

                    <div class="code-section">
                      <p><strong>Code:</strong></p>
                      <div
                        class="code-space"
                        style="min-height: 200px; border: 1px solid #ccc; margin: 10px 0"
                      ></div>
                      <p class="points">({{ problem.codePoints }} điểm)</p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="exam-footer">
              <p><strong>Tổng điểm: {{ uitExam.format.totalPoints }} điểm</strong></p>
              <p><strong>Thời gian: {{ uitExam.format.duration }}</strong></p>
              <p><strong>Loại câu hỏi: {{ uitExam.format.questionTypes.join(', ') }}</strong></p>
            </div>
          </div>
        </section>
      </main>

      <footer class="footer">
        <span>© ACE Team — IT001 • Nhập môn lập trình (C++)</span>
        <span>Build: Vue (CDN) • GitHub Pages ready</span>
      </footer>
    </div>

    <!-- <script>
      const PASS_SCORE = 80;
      const STORAGE_KEY = "ace_cpp_progress_v1";
      const TOPIC_LABELS = {
        basics: "Cơ bản & Cú pháp",
        control: "Rẽ nhánh & Vòng lặp",
        array1d: "Mảng 1 chiều",
        array2d: "Mảng 2 chiều",
        strings: "Chuỗi C-style",
        pointers: "Con trỏ",
        functions: "Hàm & tham chiếu",
        recursion: "Đệ quy",
        structs: "Struct",
      };

      // Include all data and logic from app.js here (will be done in next steps)
    </script> -->
    <script src="./app.js"></script>
  </body>
</html>
